#!/usr/bin/env pwsh
<#
.SYNOPSIS
    Start Natpudan AI application with stable terminal windows
#>

Write-Host "`nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Cyan
Write-Host "â•‘   NATPUDAN AI - STARTING APPLICATION  â•‘" -ForegroundColor Cyan
Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`n" -ForegroundColor Cyan

$repoRoot = $PSScriptRoot

# Start Backend in new window
Write-Host "Starting Backend..." -ForegroundColor Green
$backendCmd = "cd '$repoRoot\backend'; & '$repoRoot\.venv\Scripts\python.exe' -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload"
Start-Process powershell -ArgumentList "-NoExit", "-Command", $backendCmd

Start-Sleep -Seconds 3

# Start Frontend in new window
Write-Host "Starting Frontend..." -ForegroundColor Green
$frontendCmd = "cd '$repoRoot\frontend'; npm run dev"
Start-Process powershell -ArgumentList "-NoExit", "-Command", $frontendCmd

Start-Sleep -Seconds 5

# Verify services
Write-Host "`nVerifying services..." -ForegroundColor Yellow
Start-Sleep -Seconds 3

try {
    $backend = Invoke-RestMethod "http://127.0.0.1:8000/health" -TimeoutSec 5
    Write-Host "âœ… Backend: RUNNING ($($backend.status))" -ForegroundColor Green
} catch {
    Write-Host "âš ï¸  Backend: Starting (wait 30 seconds)" -ForegroundColor Yellow
}

try {
    $frontend = Invoke-WebRequest "http://localhost:5173" -UseBasicParsing -TimeoutSec 5
    Write-Host "âœ… Frontend: RUNNING (HTTP $($frontend.StatusCode))" -ForegroundColor Green
} catch {
    Write-Host "âš ï¸  Frontend: Starting (wait 30 seconds)" -ForegroundColor Yellow
}

Write-Host "`nâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—" -ForegroundColor Green
Write-Host "â•‘         APPLICATION STARTED            â•‘" -ForegroundColor Green
Write-Host "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•" -ForegroundColor Green

Write-Host "`nğŸŒ Frontend: http://localhost:5173" -ForegroundColor Cyan
Write-Host "ğŸ“š API Docs: http://127.0.0.1:8000/docs" -ForegroundColor Cyan
Write-Host "`nâš ï¸  Keep the PowerShell windows open!" -ForegroundColor Yellow
Write-Host ""
